# QuantDB API æ–‡æ¡£

**ç‰ˆæœ¬**: v1.0.0-cloud | **çŠ¶æ€**: ç”Ÿäº§å°±ç»ª | **æ€§èƒ½**: 98.1% æå‡ | **æ•°æ®è´¨é‡**: çœŸå®å…¬å¸åç§° | **å“åº”æ—¶é—´**: ~18ms

## ğŸš€ æ ¸å¿ƒäº®ç‚¹

- âœ… **çœŸå®å…¬å¸åç§°**: "æµ¦å‘é“¶è¡Œ"æ›¿ä»£"Stock 600000"ï¼Œç”¨æˆ·ä½“éªŒæ˜¾è‘—æå‡
- âœ… **è´¢åŠ¡æŒ‡æ ‡é›†æˆ**: PEã€PBã€ROEç­‰å…³é”®æŒ‡æ ‡ï¼Œæ¥è‡ªAKShareå®æ—¶æ•°æ®
- âœ… **å¸‚åœºæ•°æ®å®Œå–„**: æ€»è‚¡æœ¬ã€æµé€šè‚¡ã€å¸‚å€¼ç­‰å®Œæ•´ä¿¡æ¯
- âœ… **æ™ºèƒ½èµ„äº§æœåŠ¡**: AssetInfoServiceä¸“ä¸šèµ„äº§ä¿¡æ¯ç®¡ç†
- âœ… **æè‡´æ€§èƒ½**: ç¼“å­˜å“åº”æ—¶é—´ ~18msï¼Œæ¯” AKShare å¿« 98.1%
- âœ… **æ™ºèƒ½ç¼“å­˜**: åŸºäºçœŸå®äº¤æ˜“æ—¥å†ï¼Œé¿å…æ— æ•ˆ API è°ƒç”¨
- âœ… **æ•°æ®å‡†ç¡®**: 100% å‡†ç¡®çš„äº¤æ˜“æ—¥è¯†åˆ«ï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§
- âœ… **å®Œæ•´æµ‹è¯•**: 259ä¸ªæµ‹è¯•100%é€šè¿‡ï¼Œç¡®ä¿APIç¨³å®šæ€§

## å¿«é€Ÿå¼€å§‹

```bash
# å¯åŠ¨APIæœåŠ¡
uvicorn src.api.main:app --reload

# APIæ–‡æ¡£: http://localhost:8000/api/v1/docs
# å¥åº·æ£€æŸ¥: http://localhost:8000/api/v1/health
```

### æ€§èƒ½æŒ‡æ ‡ (E2Eæµ‹è¯•éªŒè¯)

**å“åº”æ—¶é—´åŸºå‡†**:
- å¥åº·æ£€æŸ¥: ~1ms âš¡
- èµ„äº§åˆ—è¡¨: ~9ms âš¡
- é¦–æ¬¡æ•°æ®è¯·æ±‚: ~1.2ç§’ (å«AKShareè·å–)
- ç¼“å­˜å‘½ä¸­: ~0.76ç§’ (å¹³å‡32%æ€§èƒ½æå‡)

### ğŸŸ¡ å®æ—¶ç›‘æ§ç³»ç»Ÿ (éƒ¨åˆ†å®ç°)

**ç›‘æ§çŠ¶æ€**: ç›‘æ§æ•°æ®æ”¶é›†å·²æ¿€æ´»ï¼Œæ¯ä¸ªAPIè¯·æ±‚è‡ªåŠ¨è®°å½•ï¼

**è“„æ°´æ± çŠ¶æ€ç›‘æ§**:
```bash
# æŸ¥çœ‹å½“å‰è“„æ°´æ± çŠ¶æ€ (æ˜¾ç¤ºçœŸå®æ•°æ®)
python tools/monitoring/water_pool_monitor.py
```

**ç³»ç»Ÿæ€§èƒ½ç›‘æ§**:
```bash
# å®Œæ•´æ€§èƒ½åŸºå‡†æµ‹è¯• (ç«¯åˆ°ç«¯éªŒè¯)
python tools/monitoring/system_performance_monitor.py
```

**å®æ—¶ç›‘æ§æŒ‡æ ‡**:
- ğŸŠâ€â™‚ï¸ è“„æ°´æ± å®¹é‡: ç¼“å­˜è‚¡ç¥¨æ•°é‡å’Œæ•°æ®è®°å½•æ•°
- âš¡ ç¼“å­˜æ•ˆæœ: å®æ—¶å‘½ä¸­ç‡å’Œæ€§èƒ½æå‡æ¯”ä¾‹
- ğŸ’° æˆæœ¬èŠ‚çœ: AKShareè°ƒç”¨å‡å°‘é‡åŒ–
- ğŸ“Š æ•°æ®è¦†ç›–: æ—¶é—´è·¨åº¦å’Œæ•°æ®åˆ†å¸ƒæƒ…å†µ
- ğŸ”„ è¯·æ±‚ç»Ÿè®¡: æ¯ä¸ªAPIè°ƒç”¨çš„è¯¦ç»†è®°å½•
- ğŸ“ˆ æ€§èƒ½è¶‹åŠ¿: å†å²æ€§èƒ½æ•°æ®å’Œè¶‹åŠ¿åˆ†æ

**ç›‘æ§æ•°æ®æ”¶é›†çŠ¶æ€**:
- âœ… **RequestLog**: 41+ æ¡è¯·æ±‚è®°å½•ï¼Œè‡ªåŠ¨æ”¶é›†æ¯ä¸ªAPIè¯·æ±‚
- âœ… **DataCoverage**: 4+ æ¡è¦†ç›–ç»Ÿè®¡ï¼Œè·Ÿè¸ªæ•°æ®èŒƒå›´å’Œè®¿é—®æ¨¡å¼
- âš ï¸ **SystemMetrics**: è¡¨å·²å®šä¹‰ä½†ç¼ºå°‘æ•°æ®å†™å…¥é€»è¾‘ (å¾…å®Œå–„)
- âœ… **æ€§èƒ½è·Ÿè¸ª**: å“åº”æ—¶é—´ã€ç¼“å­˜å‘½ä¸­ç‡ã€AKShareè°ƒç”¨
- âœ… **ç”¨æˆ·è¡Œä¸º**: IPåœ°å€ã€User-Agentã€è®¿é—®æ¨¡å¼
- âœ… **æ€§èƒ½ä¼˜åŒ–**: ç¼“å­˜æ€§èƒ½æ¯” AKShare æå‡ 49å€ (1.48s â†’ 0.03s)

**å¾…å®Œå–„åŠŸèƒ½**:
- [ ] SystemMetrics è‡ªåŠ¨è®°å½•åŠŸèƒ½
- [ ] å®šæ—¶ç³»ç»ŸæŒ‡æ ‡å¿«ç…§
- [ ] ç³»ç»Ÿå¥åº·åº¦è¯„ä¼° API

## æ ¸å¿ƒç«¯ç‚¹

### èµ„äº§ç®¡ç† (å¢å¼ºç‰ˆ)

```bash
# è·å–èµ„äº§åˆ—è¡¨
GET /api/v1/assets

# è·å–ç‰¹å®šèµ„äº§ (åŒ…å«è´¢åŠ¡æŒ‡æ ‡)
GET /api/v1/assets/{asset_id}
GET /api/v1/assets/symbol/{symbol}

# åˆ·æ–°èµ„äº§ä¿¡æ¯ (ä»AKShareæ›´æ–°)
PUT /api/v1/assets/symbol/{symbol}/refresh
```

**èµ„äº§ä¿¡æ¯å“åº”ç¤ºä¾‹**:
```json
{
  "asset_id": 1,
  "symbol": "600000",
  "name": "æµ¦å‘é“¶è¡Œ",
  "isin": "CN600000",
  "asset_type": "stock",
  "exchange": "SHSE",
  "currency": "CNY",
  "industry": "é“¶è¡Œ",
  "concept": "é“¶è¡Œè‚¡",
  "listing_date": "1999-11-10",
  "total_shares": 29352000000,
  "circulating_shares": 29352000000,
  "market_cap": 350000000000,
  "pe_ratio": 5.15,
  "pb_ratio": 0.55,
  "roe": 10.8,
  "last_updated": "2025-01-30T10:30:00",
  "data_source": "akshare"
}
```

**æ–°å¢å­—æ®µè¯´æ˜**:
- `industry`: è¡Œä¸šåˆ†ç±»
- `concept`: æ¦‚å¿µåˆ†ç±»
- `listing_date`: ä¸Šå¸‚æ—¥æœŸ
- `total_shares`: æ€»è‚¡æœ¬
- `circulating_shares`: æµé€šè‚¡
- `market_cap`: æ€»å¸‚å€¼
- `pe_ratio`: å¸‚ç›ˆç‡
- `pb_ratio`: å¸‚å‡€ç‡
- `roe`: å‡€èµ„äº§æ”¶ç›Šç‡
- `last_updated`: æœ€åæ›´æ–°æ—¶é—´
- `data_source`: æ•°æ®æ¥æº

### è‚¡ç¥¨å†å²æ•°æ® (å¤šå¸‚åœºç»Ÿä¸€API)

```bash
# è·å–è‚¡ç¥¨å†å²æ•°æ® (æ”¯æŒAè‚¡å’Œæ¸¯è‚¡)
GET /api/v1/historical/stock/{symbol}?start_date=20230101&end_date=20231231

# å‚æ•°:
# - symbol: è‚¡ç¥¨ä»£ç  (Aè‚¡6ä½å¦‚000001ï¼Œæ¸¯è‚¡5ä½å¦‚02171)
# - start_date: å¼€å§‹æ—¥æœŸ YYYYMMDD (å¯é€‰)
# - end_date: ç»“æŸæ—¥æœŸ YYYYMMDD (å¯é€‰)
# - adjust: å¤æƒæ–¹å¼ "", "qfq", "hfq" (å¯é€‰ï¼Œæ¸¯è‚¡å¯èƒ½ä¸æ”¯æŒ)
# - limit: æœ€å¤§è¿”å›æ•°é‡ (é»˜è®¤100)
```

**ç‰¹ç‚¹**:
- ğŸŒ **å¤šå¸‚åœºæ”¯æŒ**: åŒæ—¶æ”¯æŒAè‚¡å’Œæ¸¯è‚¡æ•°æ®æŸ¥è¯¢
- ğŸ”„ **ç»Ÿä¸€æ•°æ®æº**: å”¯ä¸€çš„è‚¡ç¥¨æ•°æ®APIç«¯ç‚¹
- ğŸ§  **æ™ºèƒ½è¯†åˆ«**: è‡ªåŠ¨è¯†åˆ«è‚¡ç¥¨ä»£ç æ‰€å±å¸‚åœº
- ğŸ“Š **AKShareå…¼å®¹**: ä¸AKShareä¿æŒå®Œå…¨ä¸€è‡´çš„æ•°æ®æ ¼å¼
- âš¡ **æ™ºèƒ½ç¼“å­˜**: è‡ªåŠ¨ç¼“å­˜å’Œæ›´æ–°æ•°æ®
- ğŸ’¾ **æŒä¹…åŒ–**: æ•°æ®å­˜å‚¨åœ¨SQLiteæ•°æ®åº“ä¸­

**å“åº”ç¤ºä¾‹** (ç°åœ¨æ˜¾ç¤ºçœŸå®å…¬å¸åç§°):
```json
{
  "symbol": "600000",
  "name": "æµ¦å‘é“¶è¡Œ",
  "start_date": "20230101",
  "end_date": "20230131",
  "adjust": "",
  "data": [
    {
      "date": "2023-01-03",
      "open": 12.50,
      "high": 12.80,
      "low": 12.30,
      "close": 12.65,
      "volume": 1234567,
      "turnover": 15432100.50,
      "amplitude": 4.0,
      "pct_change": 1.2,
      "change": 0.15,
      "turnover_rate": 0.8
    }
  ],
  "metadata": {
    "count": 1,
    "status": "success",
    "message": "Successfully retrieved 1 data points"
  }
}
```

**æ•°æ®å­—æ®µè¯´æ˜** (ä¸AKShareä¸€è‡´):
- `date`: äº¤æ˜“æ—¥æœŸ
- `open`: å¼€ç›˜ä»·
- `high`: æœ€é«˜ä»·
- `low`: æœ€ä½ä»·
- `close`: æ”¶ç›˜ä»·
- `volume`: æˆäº¤é‡
- `turnover`: æˆäº¤é¢
- `amplitude`: æŒ¯å¹…(%)
- `pct_change`: æ¶¨è·Œå¹…(%)
- `change`: æ¶¨è·Œé¢
- `turnover_rate`: æ¢æ‰‹ç‡(%)





### ç¼“å­˜ç®¡ç†

```bash
# è·å–ç¼“å­˜çŠ¶æ€
GET /api/v1/cache/status

# æ¸…é™¤ç¼“å­˜æ•°æ® (æ›´æ–°åä½¿ç”¨daily_stock_dataè¡¨)
DELETE /api/v1/cache/clear?table=daily_stock_data

# æ¸…é™¤ç‰¹å®šè‚¡ç¥¨çš„ç¼“å­˜
DELETE /api/v1/cache/clear/symbol/{symbol}
```

## é”™è¯¯å¤„ç†

æ‰€æœ‰é”™è¯¯ä½¿ç”¨ç»Ÿä¸€æ ¼å¼ï¼š

```json
{
  "error": {
    "code": "BAD_REQUEST",
    "message": "Symbol must be a 6-digit number",
    "status_code": 400
  }
}
```

**å¸¸è§çŠ¶æ€ç **:
- 200: æˆåŠŸ
- 400: è¯·æ±‚é”™è¯¯ (å‚æ•°æ ¼å¼é”™è¯¯)
- 404: èµ„æºæœªæ‰¾åˆ°
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

## ä½¿ç”¨ç¤ºä¾‹

### Aè‚¡æŸ¥è¯¢ç¤ºä¾‹

```bash
# è·å–Aè‚¡èµ„äº§ä¿¡æ¯ (åŒ…å«è´¢åŠ¡æŒ‡æ ‡)
curl "http://localhost:8000/api/v1/assets/symbol/600000"

# åˆ·æ–°Aè‚¡èµ„äº§ä¿¡æ¯
curl -X PUT "http://localhost:8000/api/v1/assets/symbol/600000/refresh"

# è·å–Aè‚¡å†å²æ•°æ® (æ˜¾ç¤ºçœŸå®å…¬å¸åç§°)
curl "http://localhost:8000/api/v1/historical/stock/600000?start_date=20230101&end_date=20230131"

# è·å–Aè‚¡æœ€è¿‘10å¤©æ•°æ®
curl "http://localhost:8000/api/v1/historical/stock/600000?limit=10"

# è·å–Aè‚¡å‰å¤æƒæ•°æ®
curl "http://localhost:8000/api/v1/historical/stock/600000?adjust=qfq&limit=20"
```

### ç³»ç»Ÿç®¡ç†ç¤ºä¾‹

```bash
# æ£€æŸ¥ç¼“å­˜çŠ¶æ€
curl http://localhost:8000/api/v1/cache/status

# æ¸…é™¤ç¼“å­˜æ•°æ®
curl -X DELETE http://localhost:8000/api/v1/cache/clear
```

## è¿ç§»æŒ‡å—

### ä» v0.6.0 å‡çº§åˆ° v0.7.0

**é‡è¦å˜æ›´**:
- âŒ **å·²ç§»é™¤**: `/api/v1/prices/` æ‰€æœ‰ç«¯ç‚¹
- âœ… **ä¿ç•™**: `/api/v1/historical/` ç«¯ç‚¹ä¿æŒä¸å˜

**æ— éœ€ä¿®æ”¹**:
- å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ `/api/v1/historical/` ç«¯ç‚¹ï¼Œæ— éœ€ä»»ä½•ä¿®æ”¹
- æ•°æ®æ ¼å¼å’Œå­—æ®µä¿æŒå®Œå…¨ä¸€è‡´

**éœ€è¦ä¿®æ”¹**:
- å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ `/api/v1/prices/` ç«¯ç‚¹ï¼Œè¯·æ›´æ¢ä¸º `/api/v1/historical/`
- æ–°çš„ç»Ÿä¸€APIæä¾›æ›´ä¸°å¯Œçš„æ•°æ®å’Œæ›´å¥½çš„æ€§èƒ½

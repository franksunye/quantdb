# QuantDB API æ–‡æ¡£

**ç‰ˆæœ¬**: v0.7.6-performance-optimized | **æ¶æ„**: ç»Ÿä¸€æ¶æ„ + é«˜æ€§èƒ½ç¼“å­˜ | **æ•°æ®åº“**: SQLite

## é‡è¦æ›´æ–° (v0.7.0)

ğŸ‰ **APIé‡æ„å®Œæˆ**: æ¶ˆé™¤äº†ä»·æ ¼æ•°æ®é‡å¤ï¼Œç»Ÿä¸€ä½¿ç”¨å†å²æ•°æ®API

- âŒ **å·²ç§»é™¤**: `/api/v1/prices/` ç«¯ç‚¹ï¼ˆå®Œå…¨åˆ é™¤ï¼‰
- âœ… **ä¿ç•™**: `/api/v1/historical/` ç«¯ç‚¹ï¼ˆä¸AKShareæ ¼å¼ä¸€è‡´ï¼‰
- ğŸ”„ **ç»Ÿä¸€**: ä½¿ç”¨ `DailyStockData` æ¨¡å‹å­˜å‚¨æ‰€æœ‰è‚¡ç¥¨æ•°æ®
- ğŸ“Š **ä¸€è‡´æ€§**: ä¸AKShareä¿æŒå®Œå…¨ä¸€è‡´çš„æ•°æ®æ ¼å¼

## å¿«é€Ÿå¼€å§‹

```bash
# å¯åŠ¨APIæœåŠ¡
uvicorn src.api.main:app --reload

# APIæ–‡æ¡£: http://localhost:8000/api/v1/docs
# å¥åº·æ£€æŸ¥: http://localhost:8000/api/v1/health
```

### æ€§èƒ½æŒ‡æ ‡ (E2Eæµ‹è¯•éªŒè¯)

**å“åº”æ—¶é—´åŸºå‡†**:
- å¥åº·æ£€æŸ¥: ~1ms âš¡
- èµ„äº§åˆ—è¡¨: ~9ms âš¡
- é¦–æ¬¡æ•°æ®è¯·æ±‚: ~1.2ç§’ (å«AKShareè·å–)
- ç¼“å­˜å‘½ä¸­: ~0.76ç§’ (å¹³å‡32%æ€§èƒ½æå‡)

### ğŸ†• å®æ—¶ç›‘æ§ç³»ç»Ÿ

**é‡å¤§å‡çº§**: ç›‘æ§æ•°æ®æ”¶é›†å·²æ¿€æ´»ï¼Œæ¯ä¸ªAPIè¯·æ±‚è‡ªåŠ¨è®°å½•ï¼

**è“„æ°´æ± çŠ¶æ€ç›‘æ§**:
```bash
# æŸ¥çœ‹å½“å‰è“„æ°´æ± çŠ¶æ€ (æ˜¾ç¤ºçœŸå®æ•°æ®)
python tools/monitoring/water_pool_monitor.py
```

**ç³»ç»Ÿæ€§èƒ½ç›‘æ§**:
```bash
# å®Œæ•´æ€§èƒ½åŸºå‡†æµ‹è¯• (ç«¯åˆ°ç«¯éªŒè¯)
python tools/monitoring/system_performance_monitor.py
```

**å®æ—¶ç›‘æ§æŒ‡æ ‡**:
- ğŸŠâ€â™‚ï¸ è“„æ°´æ± å®¹é‡: ç¼“å­˜è‚¡ç¥¨æ•°é‡å’Œæ•°æ®è®°å½•æ•°
- âš¡ ç¼“å­˜æ•ˆæœ: å®æ—¶å‘½ä¸­ç‡å’Œæ€§èƒ½æå‡æ¯”ä¾‹
- ğŸ’° æˆæœ¬èŠ‚çœ: AKShareè°ƒç”¨å‡å°‘é‡åŒ–
- ğŸ“Š æ•°æ®è¦†ç›–: æ—¶é—´è·¨åº¦å’Œæ•°æ®åˆ†å¸ƒæƒ…å†µ
- ğŸ”„ è¯·æ±‚ç»Ÿè®¡: æ¯ä¸ªAPIè°ƒç”¨çš„è¯¦ç»†è®°å½•
- ğŸ“ˆ æ€§èƒ½è¶‹åŠ¿: å†å²æ€§èƒ½æ•°æ®å’Œè¶‹åŠ¿åˆ†æ

**ç›‘æ§æ•°æ®æ”¶é›†**:
- âœ… **è‡ªåŠ¨æ”¶é›†**: æ¯ä¸ªAPIè¯·æ±‚éƒ½è¢«è®°å½•
- âœ… **å®æ—¶å­˜å‚¨**: æ•°æ®å­˜å‚¨åœ¨SQLiteç›‘æ§è¡¨ä¸­
- âœ… **æ€§èƒ½è·Ÿè¸ª**: å“åº”æ—¶é—´ã€ç¼“å­˜å‘½ä¸­ç‡ã€AKShareè°ƒç”¨
- âœ… **ç”¨æˆ·è¡Œä¸º**: IPåœ°å€ã€User-Agentã€è®¿é—®æ¨¡å¼
- âœ… **æµ‹è¯•ä¿éšœ**: 36ä¸ªç›‘æ§æµ‹è¯•ç¡®ä¿ç³»ç»Ÿè´¨é‡
- âœ… **æ€§èƒ½ä¼˜åŒ–**: ç¼“å­˜æ€§èƒ½æ¯” AKShare æå‡ 98.1%

## æ ¸å¿ƒç«¯ç‚¹

### èµ„äº§ç®¡ç†

```bash
# è·å–èµ„äº§åˆ—è¡¨
GET /api/v1/assets

# è·å–ç‰¹å®šèµ„äº§
GET /api/v1/assets/{asset_id}
GET /api/v1/assets/symbol/{symbol}
```

### è‚¡ç¥¨å†å²æ•°æ® (ç»Ÿä¸€API)

```bash
# è·å–è‚¡ç¥¨å†å²æ•°æ® (ä¸AKShareä¿æŒä¸€è‡´)
GET /api/v1/historical/stock/{symbol}?start_date=20230101&end_date=20231231

# å‚æ•°:
# - symbol: 6ä½è‚¡ç¥¨ä»£ç  (å¦‚ 000001)
# - start_date: å¼€å§‹æ—¥æœŸ YYYYMMDD (å¯é€‰)
# - end_date: ç»“æŸæ—¥æœŸ YYYYMMDD (å¯é€‰)
# - adjust: å¤æƒæ–¹å¼ "", "qfq", "hfq" (å¯é€‰)
# - limit: æœ€å¤§è¿”å›æ•°é‡ (é»˜è®¤100)
```

**ç‰¹ç‚¹**:
- ğŸ”„ **ç»Ÿä¸€æ•°æ®æº**: å”¯ä¸€çš„è‚¡ç¥¨æ•°æ®APIç«¯ç‚¹
- ğŸ“Š **AKShareå…¼å®¹**: ä¸AKShareä¿æŒå®Œå…¨ä¸€è‡´çš„æ•°æ®æ ¼å¼
- âš¡ **æ™ºèƒ½ç¼“å­˜**: è‡ªåŠ¨ç¼“å­˜å’Œæ›´æ–°æ•°æ®
- ğŸ’¾ **æŒä¹…åŒ–**: æ•°æ®å­˜å‚¨åœ¨SQLiteæ•°æ®åº“ä¸­

**å“åº”ç¤ºä¾‹**:
```json
{
  "symbol": "000001",
  "name": "å¹³å®‰é“¶è¡Œ",
  "start_date": "20230101",
  "end_date": "20230131",
  "adjust": "",
  "data": [
    {
      "date": "2023-01-03",
      "open": 12.50,
      "high": 12.80,
      "low": 12.30,
      "close": 12.65,
      "volume": 1234567,
      "turnover": 15432100.50,
      "amplitude": 4.0,
      "pct_change": 1.2,
      "change": 0.15,
      "turnover_rate": 0.8
    }
  ],
  "metadata": {
    "count": 1,
    "status": "success",
    "message": "Successfully retrieved 1 data points"
  }
}
```

**æ•°æ®å­—æ®µè¯´æ˜** (ä¸AKShareä¸€è‡´):
- `date`: äº¤æ˜“æ—¥æœŸ
- `open`: å¼€ç›˜ä»·
- `high`: æœ€é«˜ä»·
- `low`: æœ€ä½ä»·
- `close`: æ”¶ç›˜ä»·
- `volume`: æˆäº¤é‡
- `turnover`: æˆäº¤é¢
- `amplitude`: æŒ¯å¹…(%)
- `pct_change`: æ¶¨è·Œå¹…(%)
- `change`: æ¶¨è·Œé¢
- `turnover_rate`: æ¢æ‰‹ç‡(%)





### ç¼“å­˜ç®¡ç†

```bash
# è·å–ç¼“å­˜çŠ¶æ€
GET /api/v1/cache/status

# æ¸…é™¤ç¼“å­˜æ•°æ® (æ›´æ–°åä½¿ç”¨daily_stock_dataè¡¨)
DELETE /api/v1/cache/clear?table=daily_stock_data

# æ¸…é™¤ç‰¹å®šè‚¡ç¥¨çš„ç¼“å­˜
DELETE /api/v1/cache/clear/symbol/{symbol}
```

## é”™è¯¯å¤„ç†

æ‰€æœ‰é”™è¯¯ä½¿ç”¨ç»Ÿä¸€æ ¼å¼ï¼š

```json
{
  "error": {
    "code": "BAD_REQUEST",
    "message": "Symbol must be a 6-digit number",
    "status_code": 400
  }
}
```

**å¸¸è§çŠ¶æ€ç **:
- 200: æˆåŠŸ
- 400: è¯·æ±‚é”™è¯¯ (å‚æ•°æ ¼å¼é”™è¯¯)
- 404: èµ„æºæœªæ‰¾åˆ°
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

## ä½¿ç”¨ç¤ºä¾‹

```bash
# å®Œæ•´å·¥ä½œæµç¨‹ - è·å–è‚¡ç¥¨å†å²æ•°æ®
curl "http://localhost:8000/api/v1/historical/stock/000001?start_date=20230101&end_date=20230131"

# è·å–æœ€è¿‘10å¤©æ•°æ®
curl "http://localhost:8000/api/v1/historical/stock/000001?limit=10"

# è·å–å‰å¤æƒæ•°æ®
curl "http://localhost:8000/api/v1/historical/stock/000001?adjust=qfq&limit=20"



# æ£€æŸ¥ç¼“å­˜çŠ¶æ€
curl http://localhost:8000/api/v1/cache/status

# æ¸…é™¤ç‰¹å®šè‚¡ç¥¨ç¼“å­˜
curl -X DELETE http://localhost:8000/api/v1/cache/clear/symbol/000001
```

## è¿ç§»æŒ‡å—

### ä» v0.6.0 å‡çº§åˆ° v0.7.0

**é‡è¦å˜æ›´**:
- âŒ **å·²ç§»é™¤**: `/api/v1/prices/` æ‰€æœ‰ç«¯ç‚¹
- âœ… **ä¿ç•™**: `/api/v1/historical/` ç«¯ç‚¹ä¿æŒä¸å˜

**æ— éœ€ä¿®æ”¹**:
- å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ `/api/v1/historical/` ç«¯ç‚¹ï¼Œæ— éœ€ä»»ä½•ä¿®æ”¹
- æ•°æ®æ ¼å¼å’Œå­—æ®µä¿æŒå®Œå…¨ä¸€è‡´

**éœ€è¦ä¿®æ”¹**:
- å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ `/api/v1/prices/` ç«¯ç‚¹ï¼Œè¯·æ›´æ¢ä¸º `/api/v1/historical/`
- æ–°çš„ç»Ÿä¸€APIæä¾›æ›´ä¸°å¯Œçš„æ•°æ®å’Œæ›´å¥½çš„æ€§èƒ½

# QuantDB 开发指南

## 项目结构

```
QuantDB/
├── data/               # 数据文件
├── database/           # 数据库文件
├── docs/               # 文档
│   ├── api/            # API 文档
│   └── project_management/ # 项目管理文档
├── examples/           # 示例代码
├── logs/               # 日志文件
├── src/                # 源代码
│   ├── cache/          # 缓存相关代码
│   ├── data/           # 数据处理相关代码
│   ├── db/             # 数据库相关代码
│   └── utils/          # 工具函数
├── tests/              # 测试代码
│   ├── unit/           # 单元测试
│   ├── integration/    # 集成测试
│   └── temp/           # 临时测试脚本（使用后应删除）
└── README.md           # 项目说明
```

## 代码风格

- 遵循 PEP 8 规范
- 使用 4 个空格缩进
- 行长度不超过 100 个字符
- 使用有意义的变量名和函数名
- 添加适当的注释和文档字符串

## 测试规范

### 测试文件管理

1. **系统测试文件**：
   - 应放在 `tests/` 目录下，按照功能或模块分类
   - 单元测试放在 `tests/unit/` 目录下
   - 集成测试放在 `tests/integration/` 目录下
   - 测试文件名应以 `test_` 开头，例如 `test_akshare_adapter.py`

2. **临时测试脚本**：
   - 应放在 `tests/temp/` 目录下
   - 仅用于临时验证功能或调试问题
   - 使用完毕后应该删除，不应提交到版本控制系统
   - 禁止在项目根目录下创建临时测试文件

### 测试编写规范

1. **单元测试**：
   - 每个函数或方法应有对应的单元测试
   - 测试应该独立，不依赖于其他测试的执行顺序
   - 使用 pytest 框架
   - 使用 mock 对象模拟外部依赖

2. **集成测试**：
   - 测试多个组件之间的交互
   - 可以使用实际的外部依赖，如数据库或 API
   - 应该在单元测试通过后运行

## 文档规范

1. **代码文档**：
   - 每个模块、类和函数应有文档字符串
   - 使用 Google 风格的文档字符串格式
   - 说明参数、返回值和可能的异常

2. **项目文档**：
   - 项目概述和架构文档放在 `docs/` 目录下
   - API 文档放在 `docs/api/` 目录下
   - 项目管理文档放在 `docs/project_management/` 目录下

## 版本控制

版本管理是QuantDB项目的核心内容，详细的版本管理策略和最佳实践请参考 [版本管理指南](../version_management_guide.md)。

1. **分支管理**：
   - `main` 分支应该始终保持可部署状态
   - `develop` 分支用于集成已完成的特性
   - 开发新功能时应创建新的特性分支
   - 分支命名规范：
     - 特性分支：`feature/功能名称`
     - 错误修复：`bugfix/问题描述`
     - 热修复：`hotfix/问题描述`
     - 冲刺分支：`sprint/x.x`
     - 发布分支：`release/x.x.x`

2. **提交规范**：
   - 提交信息格式：`Sprint X: 简短描述`
   - 提交信息应简洁明了，说明本次提交的目的
   - 每个提交应该只包含一个逻辑变更
   - 提交前应该运行测试，确保代码可以正常工作

3. **版本号规范**：
   - 遵循语义化版本控制：`主版本.次版本.修订版本[-预发布标识]`
   - 冲刺版本使用格式：`x.y.z-sprintN`

4. **标签管理**：
   - 为每个正式发布的版本创建带注释的标签
   - 标签命名遵循版本号规范

## 依赖管理

- 使用 `requirements.txt` 管理项目依赖
- 添加新依赖时，应更新 `requirements.txt` 文件
- 尽量使用稳定版本的依赖，避免使用开发版本

## 错误处理

- 使用适当的异常处理机制
- 记录详细的错误信息，包括堆栈跟踪
- 使用日志记录错误，而不是直接打印到控制台

## 性能优化

- 使用缓存减少重复计算和 API 调用
- 优化数据库查询，避免 N+1 查询问题
- 使用异步处理大量数据

## 安全性

- 不要在代码中硬编码敏感信息，如密码和 API 密钥
- 使用环境变量或配置文件存储敏感信息
- 验证用户输入，防止注入攻击

## 持续集成

- 提交代码后自动运行测试
- 定期运行静态代码分析，检查代码质量
- 自动生成文档和测试覆盖率报告

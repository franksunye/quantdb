# QuantDB MVP 计划

## 文档信息
**文档类型**: 项目计划
**文档编号**: quantdb-PLAN-001
**版本**: 1.0.0
**创建日期**: 2025-05-13
**最后更新**: 2025-05-13
**状态**: 草稿
**负责人**: frank
**团队成员**: [待定]

**相关文档**:
- [MVP Sprint 1: 基础设施搭建](./quantdb_02_BOARD_mvp_sprint1.md) (quantdb-BOARD-001)
- [MVP Sprint 2: 后端开发](./quantdb_02_BOARD_mvp_sprint2.md) (quantdb-BOARD-002)
- [MVP Sprint 3: 前端开发](./quantdb_02_BOARD_mvp_sprint3.md) (quantdb-BOARD-003)
- [MVP Sprint 4: 集成与部署](./quantdb_02_BOARD_mvp_sprint4.md) (quantdb-BOARD-004)

## 1. MVP 概述

### 1.1 目标

开发并部署 QuantDB 的最小可行产品(MVP)，实现从本地开发到公网部署的端到端流程，验证核心功能和技术架构。

### 1.2 MVP 范围

本 MVP 将聚焦于以下核心功能:

1. **基础数据服务**: 提供股票日线数据的获取、存储和查询功能
2. **"蓄水池"缓存机制**: 实现智能数据中间层，优化数据获取和缓存
3. **简单 MCP 协议实现**: 支持基本的自然语言到结构化查询的转换
4. **REST API 接口**: 提供基本的数据查询 API
5. **云端部署**: 将服务部署到公网，可供远程访问

注意：MVP阶段将专注于提供高质量的数据服务API，不包含图表生成功能。图表展示可由外部调用方（如Agent或LLM）基于我们提供的数据自行实现。"蓄水池"机制是MVP的核心组件，它将作为AKShare等数据源之上的智能中间层，提高系统性能和稳定性。

### 1.3 技术选型

| 组件 | 本地开发 | 云端部署 | 说明 |
|-----|---------|---------|-----|
| API框架 | FastAPI | FastAPI | 高性能异步 API 框架 |
| 数据库 | SQLite | Supabase (PostgreSQL) | 本地开发使用 SQLite，云端使用 Supabase |
| API 托管 | 本地 | Vercel Serverless Functions | 后端 API 部署到 Vercel |
| 数据存储 | 本地文件 | Supabase Storage | 大文件存储 |
| 认证服务 | 无 | Supabase Auth | 用户认证 |

## 2. 用户故事

### 2.1 数据查询场景

**故事 1**: 作为一个投资者，我想通过自然语言查询股票数据，以便快速获取我需要的信息。
- 验收标准:
  - 能够理解"显示上证指数最近30天的走势"这样的查询
  - 返回正确的结构化数据结果
  - 数据格式便于外部系统（如Agent或LLM）进一步处理

**故事 2**: 作为一个分析师，我想通过 API 获取股票历史数据，以便进行进一步分析。
- 验收标准:
  - 提供 REST API 接口获取股票历史数据
  - 支持日期范围、股票代码等参数
  - 返回标准格式的 JSON 数据

**故事 3**: 作为一个开发者，我想通过API获取结构化的股票数据，以便在自己的应用中使用。
- 验收标准:
  - 提供完整的API文档
  - 支持多种查询参数和过滤条件
  - 返回标准格式的结构化数据

## 3. 技术架构

### 3.1 系统组件

```
┌─────────────┐   ┌─────────────┐   ┌─────────────┐
│  MCP 解析器  │◄──┤  REST API   │◄──┤ 认证服务    │
│  (FastAPI)  │   │  (FastAPI)  │   │ (Supabase) │
└──────┬──────┘   └──────┬──────┘   └─────────────┘
       │                 │
       ▼                 ▼
┌─────────────┐   ┌─────────────┐
│ 数据服务层   │   │ 缓存引擎     │
│ (Python)    │◄──┤ (蓄水池)     │
└──────┬──────┘   └──────┬──────┘
       │                 │
       ▼                 ▼
┌─────────────┐   ┌─────────────┐
│ 数据适配器   │   │   数据库     │
│ (AKShare)   │   │ (SQLite/PG) │
└─────────────┘   └─────────────┘
```

注意：MVP阶段专注于API服务，不包含Web界面。外部系统（如Agent或应用）可以直接调用API获取数据。"蓄水池"缓存引擎是系统的核心组件，它位于数据服务层和数据库之间，优化数据获取和缓存。

### 3.2 数据流

1. 外部系统（如Agent或应用）通过API发送请求
2. 请求经过认证服务验证
3. 对于自然语言请求，MCP 解析器将其转换为结构化查询
4. 系统检查请求的数据是否已缓存在"蓄水池"中
   - 如果已缓存且新鲜，直接从缓存返回
   - 如果未缓存或需要更新，从数据源获取数据并存入缓存
5. 数据服务层处理查询，从缓存或数据库获取数据
6. 结构化数据结果返回给调用方

## 4. 开发计划

### 4.1 Sprint 1: 基础设施搭建 (1周)

| ID | 任务 | 估计(天) | 负责人 | 优先级 |
|----|-----|---------|-------|-------|
| 1.1 | 设置 Supabase 项目 | 0.5 | TBD | 高 |
| 1.2 | 设置 Vercel 项目 | 0.5 | TBD | 高 |
| 1.3 | 创建数据库模式 | 1 | TBD | 高 |
| 1.4 | 设置本地开发环境 | 1 | TBD | 高 |
| 1.5 | 创建 CI/CD 流程 | 2 | TBD | 中 |

**交付物**:
- 可用的 Supabase 项目
- 可用的 Vercel 项目
- 初始数据库结构
- 本地开发环境配置文档
- 基本的 CI/CD 流程

### 4.2 Sprint 2: 后端开发 (2周)

| ID | 任务 | 估计(天) | 负责人 | 优先级 |
|----|-----|---------|-------|-------|
| 2.1 | 开发数据库适配层 | 2 | TBD | 高 |
| 2.2 | 实现基本的 MCP 解析器 | 3 | TBD | 高 |
| 2.3 | 开发 REST API 端点 | 2 | TBD | 高 |
| 2.4 | 实现数据获取服务 | 2 | TBD | 高 |
| 2.5 | 设计并实现"蓄水池"缓存机制 | 2 | TBD | 高 |
| 2.6 | 开发AKShare适配器 | 2 | TBD | 高 |
| 2.7 | 编写单元测试 | 1 | TBD | 中 |

**交付物**:
- 可用的数据库适配层
- 基本的 MCP 解析器
- REST API 端点
- 数据获取服务
- "蓄水池"缓存引擎
- AKShare适配器
- 单元测试

### 4.3 Sprint 3: API增强与缓存优化 (2周)

| ID | 任务 | 估计(天) | 负责人 | 优先级 |
|----|-----|---------|-------|-------|
| 3.1 | 增强API功能 | 3 | TBD | 高 |
| 3.2 | 开发API文档系统 | 2 | TBD | 高 |
| 3.3 | 实现API版本控制 | 1 | TBD | 中 |
| 3.4 | 增强MCP协议功能 | 3 | TBD | 高 |
| 3.5 | 增强数据注入策略 | 2 | TBD | 高 |
| 3.6 | 开发缓存性能监控 | 1 | TBD | 中 |
| 3.7 | 实现智能预加载机制 | 2 | TBD | 中 |
| 3.8 | 开发API测试套件 | 1 | TBD | 中 |

**交付物**:
- 增强的API功能
- 完整的API文档
- API版本控制机制
- 增强的MCP协议功能
- 高级数据注入策略
- 缓存性能监控工具
- 智能预加载机制
- API测试套件

### 4.4 Sprint 4: 部署与优化 (1周)

| ID | 任务 | 估计(天) | 负责人 | 优先级 |
|----|-----|---------|-------|-------|
| 4.1 | 部署API服务 | 1 | TBD | 高 |
| 4.2 | 配置 Supabase 数据库 | 1 | TBD | 高 |
| 4.3 | 实现API监控系统 | 1 | TBD | 中 |
| 4.4 | 端到端测试 | 1 | TBD | 高 |
| 4.5 | 性能优化 | 1 | TBD | 中 |

**交付物**:
- 公网可访问的API服务
- 生产环境数据库配置
- API监控系统
- 端到端测试报告
- 性能测试报告

## 5. 技术债务与风险

### 5.1 技术债务

1. **数据库适配**: MVP 阶段从 SQLite 迁移到 PostgreSQL 可能需要特殊处理
2. **安全性**: 初始版本可能缺乏完整的安全措施
3. **错误处理**: 可能需要更完善的错误处理机制
4. **文档**: 初始文档可能不完整

### 5.2 风险

| 风险 | 影响 | 可能性 | 缓解策略 |
|-----|-----|-------|---------|
| 数据库迁移问题 | 高 | 中 | 使用 ORM 框架，提前测试兼容性 |
| API 限流 | 中 | 高 | 实现"蓄水池"缓存机制，错峰请求 |
| 外部数据源不稳定 | 高 | 高 | 实现数据缓存和重试机制，考虑多数据源 |
| 部署环境问题 | 高 | 低 | 提前熟悉 Vercel 和 Supabase 部署流程 |
| 性能问题 | 中 | 中 | 进行性能测试，实现分页和缓存 |
| 缓存一致性问题 | 中 | 中 | 实现数据新鲜度跟踪，定期验证缓存数据 |

## 6. 成功指标

1. **功能完成度**: 所有核心功能按计划完成
2. **部署成功**: 应用成功部署到公网并可访问
3. **性能指标**:
   - API 响应时间 < 500ms
   - 缓存命中率 > 80%
   - 数据延迟 < 10分钟
4. **用户体验**: 基本功能可用，界面友好
5. **数据源稳定性**: 即使外部数据源暂时不可用，系统仍能提供服务

## 7. 后续计划

MVP 成功后，计划在以下方向继续迭代:

1. **增强 MCP 协议**: 支持更复杂的自然语言查询
2. **扩展数据源**: 增加更多金融数据源
3. **高级分析功能**: 添加技术指标和分析工具
4. **用户管理**: 完善用户注册、登录和权限管理
5. **移动端适配**: 优化移动设备体验

## 8. 资源需求

1. **开发资源**: 1-2 名全栈开发者
2. **云服务账户**: Vercel 和 Supabase 账户
3. **数据源**: 股票数据 API 访问权限
4. **开发工具**: 代码编辑器、Git、测试工具等

---

## 附录: 技术栈详情

### 技术栈

- **语言**: Python 3.9+
- **Web 框架**: FastAPI
- **ORM**: SQLAlchemy
- **数据处理**: Pandas, NumPy
- **API文档**: Swagger/OpenAPI
- **测试**: Pytest

### 云服务

- **API托管**: Vercel Serverless Functions 或其他云服务
- **Supabase**:
  - PostgreSQL 数据库
  - 认证服务
  - 存储服务

## 更新记录

| 版本 | 日期 | 更新者 | 更新内容 |
|------|------|--------|----------|
| 1.0.0 | 2025-05-13 | frank | 初始版本 |
| 1.1.0 | 2025-05-14 | frank | 调整MVP范围，移除图表功能和Web界面，专注于API服务 |
| 1.2.0 | 2025-05-15 | frank | 增加"蓄水池"缓存机制作为核心组件，调整Sprint计划和系统架构 |

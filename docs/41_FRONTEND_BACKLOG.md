# QuantDB 前端开发 Backlog

**项目**: QuantDB Frontend | **技术栈**: Streamlit | **状态**: 集成测试完成 | **更新**: 2025-06-15

## 🚨 人工验证发现的关键问题 (2025-06-15)

**验证状态**: 发现9个关键问题，需要立即修复
**影响评估**: 4个严重问题阻止1.0发布，5个高优先级问题影响用户体验

### 问题分类和修复计划

| 问题类型 | 数量 | 严重程度 | 预计修复时间 | 状态 |
|---------|------|---------|-------------|------|
| 🚨 严重错误 | 4 | 阻止发布 | 6.5小时 | 待修复 |
| ⚠️ 数据真实性 | 4 | 影响体验 | 13小时 | 待修复 |
| 🔧 功能优化 | 1 | 可接受 | 3小时 | 待修复 |

### 严重问题列表
1. **CRITICAL-002**: 股票查询页面session_state错误 (严重)
2. **CRITICAL-003**: 资产信息财务指标缺失 (严重)
3. **CRITICAL-001**: 首页标题过大 (高)
4. **CRITICAL-004**: 自选股财务信息缺失 (高)

## ✅ 集成测试结果 (2025-06-15 更新)

**总体状态**: 70%集成度，核心功能有严重问题
**测试报告**: [详细集成测试报告](./INTEGRATION_TEST_REPORT.md)
**人工验证**: 发现关键问题，需要紧急修复

### 功能完成状态 (人工验证后更新)

| 功能模块 | 开发状态 | 集成状态 | 可用性 | 验证结果 | 关键问题 |
|---------|---------|---------|--------|---------|---------|
| 📈 股票数据查询 | ✅ 完成 | ❌ 有严重错误 | 50% | 快速查询按钮报错 | session_state冲突 |
| 📊 资产信息展示 | ✅ 完成 | ❌ 数据缺失 | 60% | 财务指标显示N/A | 数据映射问题 |
| ⚡ 系统状态监控 | ✅ 完成 | ⚠️ 数据不真实 | 70% | 显示模拟数据 | 需要真实API |
| ⚡ 性能监控 | ✅ 完成 | ⚠️ 部分模拟 | 60% | 部分数据不真实 | 缓存状态错误 |
| 🎯 自选股管理 | ✅ 完成 | ⚠️ 财务缺失 | 75% | 财务指标N/A | 数据一致性 |
| 📤 数据导出 | ✅ 完成 | ⚠️ 部分集成 | 80% | 基础功能正常 | 依赖前端处理 |

### 1.0版本发布准备状态 (更新)

**❌ 阻止发布的问题**:
- 🚨 股票查询核心功能报错
- 🚨 财务指标数据缺失
- 🚨 系统状态数据不真实

**⚠️ 需要修复的问题**:
- 首页标题显示问题
- 缓存命中状态错误
- 数据真实性验证

## 🚨 紧急修复Sprint - 1.0发布前必须完成

### 严重问题修复 (预计1天)

#### URGENT-001: 修复股票查询页面session_state错误
- **优先级**: 严重 (阻止发布)
- **估时**: 2小时
- **问题**: 点击快速查询按钮时出现session_state冲突错误
- **文件**: `quantdb_frontend/pages/1_📈_股票数据查询.py`
- **解决方案**:
  - [ ] 重构show_usage_guide函数中的快速查询按钮实现
  - [ ] 避免在widget实例化后修改session_state
  - [ ] 使用不同的key或重新设计交互逻辑
- **验收标准**: 快速查询按钮正常工作，无session_state错误

#### URGENT-002: 修复资产信息财务指标显示
- **优先级**: 严重 (阻止发布)
- **估时**: 3小时
- **问题**: ROE、总股本、流通股本、每股收益、每股净资产显示为N/A
- **文件**: `quantdb_frontend/pages/2_📊_资产信息.py`, 后端资产信息API
- **解决方案**:
  - [ ] 检查后端API返回的数据结构和字段名
  - [ ] 修复前端字段映射问题
  - [ ] 确保AKShare数据正确获取和解析
  - [ ] 添加数据验证和错误处理
- **验收标准**: 所有财务指标正确显示真实数据

#### URGENT-003: 修复首页标题显示
- **优先级**: 高
- **估时**: 0.5小时
- **问题**: 首页标题过大，影响视觉效果
- **文件**: `quantdb_frontend/app.py`
- **解决方案**:
  - [ ] 调整标题级别，使用更合适的大小
  - [ ] 优化首页布局和视觉效果
- **验收标准**: 首页标题大小合适，视觉效果良好

#### URGENT-004: 修复自选股财务信息显示
- **优先级**: 高
- **估时**: 1小时
- **问题**: 自选股详情中财务指标显示为N/A
- **文件**: `quantdb_frontend/pages/5_🎯_自选股管理.py`
- **解决方案**:
  - [ ] 确保与资产信息页面使用相同的数据获取逻辑
  - [ ] 修复财务指标字段映射
- **验收标准**: 自选股财务信息正确显示

### 数据真实性修复 (预计1天)

#### URGENT-005: 修复首页系统状态概览
- **优先级**: 高
- **估时**: 4小时
- **问题**: 系统状态概览显示硬编码的模拟数据
- **文件**: `quantdb_frontend/app.py`
- **解决方案**:
  - [ ] 集成真实的API调用获取系统状态
  - [ ] 实现动态响应时间计算
  - [ ] 获取真实的缓存命中率和数据质量指标
  - [ ] 添加错误处理和降级显示
- **验收标准**: 首页显示真实的系统状态数据

#### URGENT-006: 修复系统状态页面数据显示
- **优先级**: 高
- **估时**: 3小时
- **问题**: 响应时间格式错误，数据库统计信息为0
- **文件**: `quantdb_frontend/pages/3_⚡_系统状态.py`
- **解决方案**:
  - [ ] 修复响应时间显示格式 (应显示毫秒而非时间)
  - [ ] 修复数据库大小、记录数、资产数量的获取
  - [ ] 检查缓存状态API的数据映射
- **验收标准**: 所有系统状态指标显示正确的真实数据

#### URGENT-007: 验证性能监控页面数据真实性
- **优先级**: 高
- **估时**: 4小时
- **问题**: 性能监控数据可能是模拟数据
- **文件**: `quantdb_frontend/pages/4_⚡_性能监控.py`
- **解决方案**:
  - [ ] 验证所有性能指标的数据来源
  - [ ] 确保缓存测试返回真实的命中状态
  - [ ] 实现真实的系统资源监控
  - [ ] 标识模拟数据并提供说明
- **验收标准**: 明确区分真实数据和模拟数据

#### URGENT-008: 修复缓存命中状态显示
- **优先级**: 中
- **估时**: 3小时
- **问题**: 性能测试中缓存状态总是显示"未命中"
- **文件**: 后端缓存逻辑，前端性能测试
- **解决方案**:
  - [ ] 检查后端缓存命中逻辑的实现
  - [ ] 修复缓存状态的元数据传递
  - [ ] 确保重复查询能正确显示缓存命中
- **验收标准**: 重复查询正确显示缓存命中状态

## 🎯 Sprint 规划 (修复完成后)

### Sprint 1: MVP基础功能 (1周) - ✅ 已完成
**目标**: 实现核心数据查询和展示功能

#### Epic 1: 项目基础设施
- [ ] **FRONT-001**: 创建前端项目结构
  - 优先级: 高
  - 估时: 2小时
  - 描述: 创建quantdb_frontend目录结构，配置基础文件
  - 验收标准: 项目结构完整，可以启动基础Streamlit应用

- [ ] **FRONT-002**: 实现API客户端封装
  - 优先级: 高
  - 估时: 4小时
  - 描述: 封装QuantDB API调用，处理错误和异常
  - 验收标准: 可以成功调用所有主要API端点，有完善的错误处理

- [ ] **FRONT-003**: 配置开发环境
  - 优先级: 高
  - 估时: 1小时
  - 描述: 创建requirements.txt，配置启动脚本
  - 验收标准: 一键安装依赖和启动应用

#### Epic 2: 股票数据查询页面
- [ ] **FRONT-004**: 实现股票代码输入组件
  - 优先级: 高
  - 估时: 2小时
  - 描述: 股票代码输入框，支持6位数字验证
  - 验收标准: 输入验证正确，用户体验友好

- [ ] **FRONT-005**: 实现日期范围选择器
  - 优先级: 高
  - 估时: 2小时
  - 描述: 开始和结束日期选择，默认最近30天
  - 验收标准: 日期选择逻辑正确，有合理的默认值

- [ ] **FRONT-006**: 实现数据查询和展示
  - 优先级: 高
  - 估时: 4小时
  - 描述: 调用API获取数据，以表格形式展示
  - 验收标准: 数据正确展示，加载状态清晰

- [ ] **FRONT-007**: 实现基础价格图表
  - 优先级: 中
  - 估时: 3小时
  - 描述: 使用Streamlit原生图表展示收盘价趋势
  - 验收标准: 图表清晰美观，交互性良好

#### Epic 3: 资产信息页面
- [ ] **FRONT-008**: 实现资产基本信息展示
  - 优先级: 高
  - 估时: 3小时
  - 描述: 展示公司名称、行业、交易所等基本信息
  - 验收标准: 信息展示完整，布局美观

- [ ] **FRONT-009**: 实现财务指标展示
  - 优先级: 高
  - 估时: 3小时
  - 描述: 使用st.metric展示PE、PB、ROE等指标
  - 验收标准: 指标展示清晰，有适当的格式化

- [ ] **FRONT-010**: 实现数据覆盖信息
  - 优先级: 中
  - 估时: 2小时
  - 描述: 展示数据起止日期、记录数等覆盖信息
  - 验收标准: 覆盖信息准确，有助于用户了解数据质量

#### Epic 4: 系统状态页面
- [ ] **FRONT-011**: 实现健康状态检查
  - 优先级: 中
  - 估时: 2小时
  - 描述: 调用health API，展示系统状态
  - 验收标准: 状态信息准确，有清晰的状态指示

- [ ] **FRONT-012**: 实现基础系统信息展示
  - 优先级: 低
  - 估时: 2小时
  - 描述: 展示版本信息、数据库基本信息
  - 验收标准: 信息展示完整，有助于系统监控

### Sprint 2: 性能可视化 (1周)
**目标**: 展示系统性能优势和缓存效果

#### Epic 5: 缓存性能监控
- [ ] **FRONT-013**: 集成缓存命中率展示
  - 优先级: 高
  - 估时: 4小时
  - 描述: 展示每次查询的缓存命中状态
  - 验收标准: 缓存状态清晰展示，有性能对比

- [ ] **FRONT-014**: 实现响应时间监控
  - 优先级: 高
  - 估时: 3小时
  - 描述: 展示API响应时间和性能提升
  - 验收标准: 响应时间准确记录，有历史对比

- [ ] **FRONT-015**: 实现AKShare调用状态展示
  - 优先级: 中
  - 估时: 2小时
  - 描述: 显示是否调用了外部AKShare API
  - 验收标准: 调用状态清晰，有助于理解缓存机制

#### Epic 6: 系统性能仪表板
- [ ] **FRONT-016**: 实现数据库信息展示
  - 优先级: 中
  - 估时: 3小时
  - 描述: 展示数据库大小、总记录量等信息
  - 验收标准: 信息准确，有适当的可视化

- [ ] **FRONT-017**: 实现性能趋势图表
  - 优先级: 中
  - 估时: 4小时
  - 描述: 展示历史性能数据趋势
  - 验收标准: 趋势图清晰，有助于性能分析

### Sprint 3: 分析工具 (1周)
**目标**: 提供基础的数据分析功能

#### Epic 7: 价格分析工具
- [ ] **FRONT-018**: 实现涨跌幅分析
  - 优先级: 中
  - 估时: 4小时
  - 描述: 计算和展示涨跌幅分布
  - 验收标准: 分析结果准确，可视化清晰

- [ ] **FRONT-019**: 实现价格统计摘要
  - 优先级: 中
  - 估时: 3小时
  - 描述: 展示最高价、最低价、平均价等统计信息
  - 验收标准: 统计信息准确，展示美观

- [ ] **FRONT-020**: 实现成交量分析
  - 优先级: 低
  - 估时: 3小时
  - 描述: 展示成交量趋势和分析
  - 验收标准: 成交量分析有意义，图表清晰

#### Epic 8: 高级图表功能
- [ ] **FRONT-021**: 集成Plotly交互式图表
  - 优先级: 中
  - 估时: 5小时
  - 描述: 使用Plotly创建更丰富的交互式图表
  - 验收标准: 图表交互性好，功能丰富

- [ ] **FRONT-022**: 实现多图表组合展示
  - 优先级: 低
  - 估时: 3小时
  - 描述: 在同一页面展示多个相关图表
  - 验收标准: 布局合理，图表协调

### Sprint 4: 个性化功能 (1周)
**目标**: 提供用户个性化功能和数据导出

#### Epic 9: 自选股管理
- [ ] **FRONT-023**: 实现自选股添加/删除
  - 优先级: 中
  - 估时: 4小时
  - 描述: 用户可以管理自己的股票清单
  - 验收标准: 自选股管理功能完整，数据持久化

- [ ] **FRONT-024**: 实现自选股批量查询
  - 优先级: 中
  - 估时: 3小时
  - 描述: 一键查询所有自选股的数据
  - 验收标准: 批量查询高效，结果展示清晰

- [ ] **FRONT-025**: 实现自选股数据概览
  - 优先级: 低
  - 估时: 3小时
  - 描述: 自选股的汇总信息和对比
  - 验收标准: 概览信息有价值，便于快速了解

#### Epic 10: 数据导出功能
- [ ] **FRONT-026**: 实现CSV数据导出
  - 优先级: 中
  - 估时: 2小时
  - 描述: 支持将查询结果导出为CSV格式
  - 验收标准: 导出功能正常，文件格式正确

- [ ] **FRONT-027**: 实现Excel数据导出
  - 优先级: 低
  - 估时: 3小时
  - 描述: 支持导出为Excel格式，包含格式化
  - 验收标准: Excel文件格式美观，数据完整

- [ ] **FRONT-028**: 实现图表导出
  - 优先级: 低
  - 估时: 2小时
  - 描述: 支持将图表导出为图片格式
  - 验收标准: 图片质量高，适合报告使用

#### Epic 11: 用户体验优化
- [ ] **FRONT-029**: 实现用户偏好设置
  - 优先级: 低
  - 估时: 3小时
  - 描述: 保存用户的默认设置和偏好
  - 验收标准: 设置功能完整，体验流畅

- [ ] **FRONT-030**: 实现错误处理优化
  - 优先级: 高
  - 估时: 3小时
  - 描述: 完善错误提示和异常处理
  - 验收标准: 错误提示友好，系统稳定

## 🔧 技术债务和优化

### 性能优化
- [ ] **TECH-001**: 实现数据缓存机制
  - 优先级: 中
  - 估时: 4小时
  - 描述: 在前端实现简单的数据缓存，减少API调用

- [ ] **TECH-002**: 优化图表渲染性能
  - 优先级: 中
  - 估时: 3小时
  - 描述: 优化大数据量时的图表渲染性能

### 代码质量
- [ ] **TECH-003**: 实现组件化架构
  - 优先级: 中
  - 估时: 5小时
  - 描述: 将页面拆分为可复用的组件

- [ ] **TECH-004**: 添加类型注解
  - 优先级: 低
  - 估时: 3小时
  - 描述: 为Python代码添加完整的类型注解

### 测试覆盖
- [ ] **TEST-001**: 实现API客户端测试
  - 优先级: 中
  - 估时: 4小时
  - 描述: 为API客户端编写单元测试

- [ ] **TEST-002**: 实现页面功能测试
  - 优先级: 低
  - 估时: 6小时
  - 描述: 为主要页面功能编写测试

## 📊 进度跟踪

### 完成标准
- [ ] 功能完整性: 所有计划功能实现
- [ ] 用户体验: 界面友好，操作流畅
- [ ] 性能表现: 响应时间满足要求
- [ ] 代码质量: 结构清晰，易于维护
- [ ] 文档完善: 用户文档和开发文档齐全

### 里程碑
- **M1**: MVP功能完成 (Sprint 1结束)
- **M2**: 性能监控完成 (Sprint 2结束)
- **M3**: 分析工具完成 (Sprint 3结束)
- **M4**: 个性化功能完成 (Sprint 4结束)

### 风险评估
- **技术风险**: Streamlit组件限制，可能需要自定义组件
- **性能风险**: 大数据量时的前端性能问题
- **用户体验风险**: 界面设计可能需要多次迭代
- **集成风险**: 与后端API的集成可能遇到兼容性问题

## 🎯 成功指标

### 功能指标
- 支持所有主要股票代码查询
- 数据查询成功率 > 95%
- 图表加载时间 < 2秒
- 支持至少1年历史数据展示

### 用户体验指标
- 页面加载时间 < 3秒
- 操作流程简洁 (不超过3步)
- 错误恢复时间 < 5秒
- 用户满意度 > 4.0/5.0

### 技术指标
- 代码覆盖率 > 80%
- API调用成功率 > 98%
- 前端组件复用率 > 70%
- 文档覆盖率 100%

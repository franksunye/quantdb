# æŒ‡æ•°æ•°æ®APIå®ç°æ€»ç»“

## ğŸ¯ ä»»åŠ¡å®Œæˆæƒ…å†µ

æ ¹æ®Backlogä¸­çš„å·¥ä½œé¡¹è¦æ±‚ï¼Œå·²å®ŒæˆæŒ‡æ•°æ•°æ®APIçš„å®Œæ•´å®ç°ï¼š

### âœ… å·²å®Œæˆçš„åŠŸèƒ½

#### 1. æŒ‡æ•°å†å²æ•°æ®æ¥å£
- **APIç«¯ç‚¹**: `GET /api/v1/index/historical/{symbol}`
- **åŠŸèƒ½**: è·å–æŒ‡æ•°çš„å†å²ä»·æ ¼æ•°æ®
- **æ”¯æŒå‚æ•°**: å¼€å§‹æ—¥æœŸã€ç»“æŸæ—¥æœŸã€æ•°æ®é¢‘ç‡ï¼ˆæ—¥/å‘¨/æœˆï¼‰
- **ç¼“å­˜ç­–ç•¥**: æ•°æ®åº“æ°¸ä¹…ç¼“å­˜ï¼Œå¢é‡æ›´æ–°

#### 2. æŒ‡æ•°å®æ—¶æ•°æ®æ¥å£  
- **APIç«¯ç‚¹**: `GET /api/v1/index/realtime/{symbol}`
- **åŠŸèƒ½**: è·å–æŒ‡æ•°çš„å®æ—¶ä»·æ ¼æ•°æ®
- **ç¼“å­˜ç­–ç•¥**: äº¤æ˜“æ—¶é—´1-5åˆ†é’Ÿç¼“å­˜ï¼Œéäº¤æ˜“æ—¶é—´30åˆ†é’Ÿç¼“å­˜

#### 3. æ”¯æŒä¸»è¦æŒ‡æ•°
- **ä¸Šè¯æŒ‡æ•°** (000001)
- **æ·±è¯æˆæŒ‡** (399001) 
- **åˆ›ä¸šæ¿æŒ‡** (399006)
- **æ²ªæ·±300** (000300)
- **ä¸Šè¯50** (000016)
- **ä¸­è¯500** (000905)
- ä»¥åŠå…¶ä»–ä¸»è¦æŒ‡æ•°

#### 4. PythonåŒ…å®Œæ•´é›†æˆ
- `qdb.get_index_data()` - è·å–æŒ‡æ•°å†å²æ•°æ®
- `qdb.get_index_realtime()` - è·å–æŒ‡æ•°å®æ—¶æ•°æ®
- `qdb.get_index_list()` - è·å–æŒ‡æ•°åˆ—è¡¨

## ğŸ—ï¸ æ¶æ„å®ç°

### 1. æ•°æ®æ¨¡å‹å±‚ (`core/models/index_data.py`)
```python
class IndexData(Base):           # å†å²æŒ‡æ•°æ•°æ®
class RealtimeIndexData(Base):   # å®æ—¶æŒ‡æ•°æ•°æ®  
class IndexListCache(Base):      # æŒ‡æ•°åˆ—è¡¨ç¼“å­˜
class IndexListCacheManager(Base): # ç¼“å­˜ç®¡ç†å™¨
```

### 2. AKShareé€‚é…å™¨æ‰©å±• (`core/cache/akshare_adapter.py`)
```python
def get_index_data()           # åŒ…è£… index_zh_a_hist
def get_index_realtime_data()  # åŒ…è£… stock_zh_index_spot_em
def get_index_list()           # åŒ…è£… stock_zh_index_spot_em
```

### 3. æœåŠ¡å±‚ (`core/services/index_data_service.py`)
```python
class IndexDataService:
    def get_index_data()           # å†å²æ•°æ®æœåŠ¡
    def get_realtime_index_data()  # å®æ—¶æ•°æ®æœåŠ¡
    def get_index_list()           # æŒ‡æ•°åˆ—è¡¨æœåŠ¡
```

### 4. APIè·¯ç”±å±‚ (`api/routers/index_data.py`)
```python
@router.get("/historical/{symbol}")  # å†å²æ•°æ®ç«¯ç‚¹
@router.get("/realtime/{symbol}")    # å®æ—¶æ•°æ®ç«¯ç‚¹
@router.get("/list")                 # æŒ‡æ•°åˆ—è¡¨ç«¯ç‚¹
@router.get("/categories")           # æŒ‡æ•°åˆ†ç±»ç«¯ç‚¹
```

### 5. PythonåŒ…é›†æˆ
- **client.py**: æ·»åŠ å…¬å¼€APIå‡½æ•°
- **simple_client.py**: å®ç°SimpleQDBClientçš„æŒ‡æ•°æ–¹æ³•

## ğŸ“Š APIç«¯ç‚¹è¯¦æƒ…

### å†å²æ•°æ®API
```http
GET /api/v1/index/historical/000001?start_date=20240101&end_date=20240201&period=daily
```

### å®æ—¶æ•°æ®API  
```http
GET /api/v1/index/realtime/000001?force_refresh=false
```

### æŒ‡æ•°åˆ—è¡¨API
```http
GET /api/v1/index/list?category=æ²ªæ·±é‡è¦æŒ‡æ•°&force_refresh=false
```

### æŒ‡æ•°åˆ†ç±»API
```http
GET /api/v1/index/categories
```

## ğŸ PythonåŒ…ä½¿ç”¨ç¤ºä¾‹

```python
import quantdb as qdb

# è·å–æŒ‡æ•°å†å²æ•°æ®
df = qdb.get_index_data("000001", start_date="20240101", end_date="20240201")

# è·å–æŒ‡æ•°å®æ—¶æ•°æ®
realtime = qdb.get_index_realtime("000001")

# è·å–æŒ‡æ•°åˆ—è¡¨
index_list = qdb.get_index_list(category="æ²ªæ·±é‡è¦æŒ‡æ•°")
```

## ğŸš€ ç¼“å­˜ç­–ç•¥

### å†å²æ•°æ®ç¼“å­˜
- **å­˜å‚¨**: SQLiteæ•°æ®åº“
- **ç­–ç•¥**: æ°¸ä¹…ç¼“å­˜ï¼Œå¢é‡æ›´æ–°
- **æ€§èƒ½**: é¦–æ¬¡æŸ¥è¯¢2-5ç§’ï¼Œåç»­æ¯«ç§’çº§å“åº”

### å®æ—¶æ•°æ®ç¼“å­˜
- **äº¤æ˜“æ—¶é—´**: 1-5åˆ†é’ŸTTL
- **éäº¤æ˜“æ—¶é—´**: 30åˆ†é’ŸTTL
- **è‡ªåŠ¨åˆ¤æ–­**: åŸºäºAè‚¡äº¤æ˜“æ—¶é—´ï¼ˆ9:30-11:30, 13:00-15:00ï¼‰

### æŒ‡æ•°åˆ—è¡¨ç¼“å­˜
- **æ›´æ–°é¢‘ç‡**: æ¯æ—¥æ›´æ–°
- **å­˜å‚¨**: æ•°æ®åº“è¡¨
- **ç®¡ç†**: è‡ªåŠ¨æ¸…ç†è¿‡æœŸæ•°æ®

## ğŸ“ æ–‡ä»¶ç»“æ„

```
core/
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ index_data.py          # æŒ‡æ•°æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ __init__.py           # æ›´æ–°å¯¼å…¥
â”œâ”€â”€ cache/
â”‚   â””â”€â”€ akshare_adapter.py    # æ‰©å±•AKShareæ¥å£
â””â”€â”€ services/
    â””â”€â”€ index_data_service.py # æŒ‡æ•°æ•°æ®æœåŠ¡

api/
â”œâ”€â”€ routers/
â”‚   â”œâ”€â”€ index_data.py         # æŒ‡æ•°APIè·¯ç”±
â”‚   â””â”€â”€ __init__.py          # æ›´æ–°å¯¼å…¥
â””â”€â”€ main.py                  # æ³¨å†Œæ–°è·¯ç”±

qdb/
â”œâ”€â”€ client.py                # æ·»åŠ å…¬å¼€API
â””â”€â”€ simple_client.py         # å®ç°å®¢æˆ·ç«¯æ–¹æ³•

docs/
â””â”€â”€ INDEX_API_GUIDE.md       # å®Œæ•´ä½¿ç”¨æŒ‡å—

tests/
â”œâ”€â”€ test_index_api.py        # APIæµ‹è¯•è„šæœ¬
â””â”€â”€ verify_index_implementation.py # å®ç°éªŒè¯è„šæœ¬
```

## âœ… è´¨é‡ä¿è¯

### 1. è¯­æ³•éªŒè¯
- æ‰€æœ‰Pythonæ–‡ä»¶è¯­æ³•æ­£ç¡®
- å¯¼å…¥å…³ç³»å®Œæ•´
- ç±»å’Œæ–¹æ³•å®šä¹‰å®Œæ•´

### 2. æ¶æ„ä¸€è‡´æ€§
- éµå¾ªç°æœ‰çš„å®æ—¶è¡Œæƒ…APIå’Œè‚¡ç¥¨åˆ—è¡¨APIæ¨¡å¼
- ä¿æŒç›¸åŒçš„ç¼“å­˜ç­–ç•¥å’Œé”™è¯¯å¤„ç†
- ç»Ÿä¸€çš„å“åº”æ ¼å¼å’ŒçŠ¶æ€ç 

### 3. åŠŸèƒ½å®Œæ•´æ€§
- âœ… æŒ‡æ•°å†å²æ•°æ®æ¥å£
- âœ… æŒ‡æ•°å®æ—¶æ•°æ®æ¥å£  
- âœ… æ”¯æŒä¸»è¦æŒ‡æ•°
- âœ… PythonåŒ…é›†æˆ
- âœ… æ™ºèƒ½ç¼“å­˜ç­–ç•¥
- âœ… å®Œæ•´æ–‡æ¡£å’Œæµ‹è¯•

## ğŸ”„ ä¸ç°æœ‰åŠŸèƒ½çš„é›†æˆ

### æ•°æ®åº“æ¨¡å‹
- æ–°å¢4ä¸ªæŒ‡æ•°ç›¸å…³è¡¨
- ä¸ç°æœ‰Assetè¡¨ä¿æŒå…¼å®¹
- ç»Ÿä¸€çš„æ—¶é—´æˆ³å’Œç¼“å­˜ç­–ç•¥

### APIè·¯ç”±
- æ³¨å†Œåˆ°FastAPIä¸»åº”ç”¨
- éµå¾ª`/api/v1/`è·¯å¾„è§„èŒƒ
- ä¸ç°æœ‰ä¸­é—´ä»¶å…¼å®¹

### PythonåŒ…
- æ— ç¼é›†æˆåˆ°ç°æœ‰qdbåŒ…
- ä¿æŒAPIä¸€è‡´æ€§
- æ”¯æŒç®€åŒ–å®¢æˆ·ç«¯æ¨¡å¼

## ğŸ“ˆ æ€§èƒ½ç‰¹ç‚¹

### ç¼“å­˜æ•ˆæœ
- **é¦–æ¬¡æŸ¥è¯¢**: 2-5ç§’ï¼ˆä»AKShareè·å–ï¼‰
- **ç¼“å­˜å‘½ä¸­**: æ¯«ç§’çº§å“åº”
- **å†…å­˜å ç”¨**: æœ€å°åŒ–è®¾è®¡

### å¹¶å‘æ”¯æŒ
- æ•°æ®åº“è¿æ¥æ± 
- å¼‚æ­¥APIè®¾è®¡
- æ™ºèƒ½ç¼“å­˜é¿å…é‡å¤è¯·æ±‚

## ğŸ‰ æ€»ç»“

æŒ‡æ•°æ•°æ®APIå·²å®Œå…¨æŒ‰ç…§Backlogè¦æ±‚å®ç°ï¼ŒåŒ…æ‹¬ï¼š

1. **å®Œæ•´çš„APIåŠŸèƒ½** - å†å²æ•°æ®ã€å®æ—¶æ•°æ®ã€æŒ‡æ•°åˆ—è¡¨
2. **PythonåŒ…é›†æˆ** - æ— ç¼é›†æˆåˆ°qdbåŒ…
3. **æ™ºèƒ½ç¼“å­˜ç­–ç•¥** - é«˜æ€§èƒ½æ•°æ®è®¿é—®
4. **å®Œæ•´æ–‡æ¡£** - ä½¿ç”¨æŒ‡å—å’ŒAPIæ–‡æ¡£
5. **è´¨é‡ä¿è¯** - è¯­æ³•éªŒè¯å’Œæ¶æ„ä¸€è‡´æ€§

è¯¥å®ç°éµå¾ªäº†é¡¹ç›®çš„KISSåŸåˆ™ï¼Œä¿æŒäº†ä¸ç°æœ‰åŠŸèƒ½çš„ä¸€è‡´æ€§ï¼Œå¹¶æä¾›äº†å®Œæ•´çš„æµ‹è¯•å’Œæ–‡æ¡£æ”¯æŒã€‚

**çŠ¶æ€**: âœ… å®Œæˆï¼Œå¯ä»¥éƒ¨ç½²å’Œä½¿ç”¨
